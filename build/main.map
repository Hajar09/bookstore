{"version":3,"sources":["webpack:///webpack/bootstrap 3720f053f11ebd72d902","webpack:///external \"express\"","webpack:///external \"mongoose\"","webpack:///./src/index.js","webpack:///external \"dotenv/config\"","webpack:///external \"serve-favicon\"","webpack:///external \"volleyball\"","webpack:///external \"passport-local\"","webpack:///external \"express-session\"","webpack:///external \"multer\"","webpack:///external \"path\"","webpack:///external \"connect-flash\"","webpack:///external \"passport\"","webpack:///./src/routes/users.js","webpack:///./src/models/user.js","webpack:///external \"bcrypt\""],"names":["app","express","SERV_PORT","DBurl","process","env","mongoose","connect","db","connection","on","console","error","bind","once","log","set","path","join","__dirname","use","static","json","urlencoded","extended","session","secret","resave","saveUninitialized","listen","users","Router","get","req","res","render","title","post","next","userData","body","save","err","user","userId","_id","redirect","email","password","User","authenticate","Error","status","Schema","UserSchema","name","type","String","required","trim","unique","username","statics","callback","find","exec","bcrypt","compare","result","pre","hash","model"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 3720f053f11ebd72d902","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 1\n// module chunks = 0","import express from \"express\"\nconst app = express()\nimport \"dotenv/config\"\nimport favicon from \"serve-favicon\";\nimport volleyball from \"volleyball\"\nimport mongoose from \"mongoose\"\nimport {\n    LocalStrategy\n} from \"passport-local\";\nimport session from \"express-session\"\nimport multer from \"multer\";\nimport path from 'path'\nimport flash from \"connect-flash\";\nconst {SERV_PORT, DBurl} = process.env\nimport passport from \"passport\"\n\nimport {\n    users\n} from './routes/users';\n\n\n\n\n//connexion mongoose\nmongoose.connect(DBurl)\nconst db = mongoose.connection;\ndb.on('error', console.error.bind(console, 'connection error:'));\ndb.once('open', () => {\n    console.log(\"MongoDB est là!\")\n});\n\n//lien pug\napp.set('views', path.join(__dirname, 'views'));\napp.set('view engine', 'pug');\napp.use(express.static(path.join(__dirname, \"public\")))\n\n\napp.use(volleyball)\napp.use(express.json())\napp.use(express.urlencoded({\n    extended: false\n}))\n\n\napp.use(session({\n    secret: 'JojoHelloFantasy',\n    resave: true,\n    saveUninitialized: false\n}))\n\napp.use('/', users)\n\napp.listen(SERV_PORT, ()=>{\n    console.log(`[APP working on port : ${SERV_PORT}]`)\n})\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"dotenv/config\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dotenv/config\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"serve-favicon\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"serve-favicon\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"volleyball\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"volleyball\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"passport-local\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport-local\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"express-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-session\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"multer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"multer\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"connect-flash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"connect-flash\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"passport\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport\"\n// module id = 12\n// module chunks = 0","import express from \"express\"\nconst users = express.Router()\nimport {User} from \"../models/user\"\n\nusers.get(\"/\", (req, res) => {\n    res.render('home', {\n        title:\"home\"\n    })\n})\n\nusers.get(\"/about\", (req, res) => {\n    res.render('about', {\n        title:\"about\"\n    })\n})\n\nusers.get(\"/profil\", (req, res) => {\n    res.render('profil', {\n        title:\"profil\"\n    })\n})\n\nusers.get(\"/register\", (req, res) => {\n    res.render('register', {\n        title:\"register\"\n    })\n})\n\nusers.post(\"/register\", (req, res, next) => {\n    const userData = new User(req.body)\n        userData.save((err, user) => {\n            if(err) {\n                next(err)\n            }\n            else {\n                req.session.userId = user._id//pour express-session; quand on appelle quelqu'un, on appelle sa session\n                console.log(user)\n                res.redirect('/profil')\n                next()\n            }\n        })\n})\n\nusers.get(\"/login\", (req, res, next) => {\n    res.render('login', {\n        title:\"login\"\n    })\n})\n\nusers.post('/login', (req, res, next) => {\n    if(req.body.email && req.body.password) {\n        User.authenticate(req.body.email, req.body.password, function (error, user) {\n            if(error || !user) {\n                var err = new Error('Wrong email or password');\n                err.status = 401;\n                return next(err)\n                \n            }\n            else {\n                req.session.userId = user._id;\n                return res.redirect('/profil')\n            }\n        });\n    }\n    else {\n        var err = new Error('Email and password are required.')\n        err.status = 401;\n        return next(err)\n    }\n})\n\n\n\nexport { users }\n\n\n// WEBPACK FOOTER //\n// ./src/routes/users.js","import mongoose from \"mongoose\"\nimport bcrypt from \"bcrypt\"\nconst Schema = mongoose.Schema\n\n\nconst UserSchema = new Schema({\n    name:{\n        type: String,\n        required: true,\n        trim: true\n    },\n    email: {\n        type: String,\n        unique: true,\n        required: true\n     //enlever les espaces dans les champs\n    },\n    //favbook:{\n        //type: String,\n        //require: true,\n        //trim: true\n    //}\n    username: {\n        type:String,\n        required:true,\n        trim: true\n    },\n    password: {\n        type:String,\n        required:true\n    }\n})\n\n//authenticate input\n\nUserSchema.statics.authenticate = function(email, password, callback) {\n    User.find({email:email})\n        .exec(function(error, user) {//une méthode mongodb, on va exécuter une fonction\n            if(error) {\n                console.log('erreur de base de données')\n                return callback(error);\n            }\n            else if (!user) {\n                var err = new Error('User not found.')\n                console.log('utilisateur pas trouvé')\n                err.status = 401;\n                return callback(err);\n            }\n\n            \n\n            console.log('pb mot de passe');\n            console.log('password :' + password)\n            console.log('user :' + user)\n            //user = JSON.parse(JSON.stringify(user))[0];\n\n            //console.log(x.property_actually_now_defined);\n            //console.log('propriétés de user :' + Object.getOwnPropertyNames(user))\n            //console.log('user.password :' + x.password)\n\n        \n            bcrypt.compare(password, user.password, function(error, result) {//password (ce qu'on a ecrit dans le login) comparé avec user.password(ce qui se trouve dans la base de données)\n                \n                if(result === true) {//si on a bon\n                    return callback(null, user)\n                }  \n                else {\n                    \n                    return callback();\n                    \n                }\n            })\n        })\n}\n\nUserSchema.pre('save', function(next) {\n    const user = this; //this= chaque instance du model\n    console.log(this)\n    bcrypt.hash(user.password, 10, function(err, hash){\n        if(err) return next(err)\n        user.password = hash;\n        next()\n    })\n})\n\n\nconst User = mongoose.model('User', UserSchema)\n\nexport { User }\n\n\n// WEBPACK FOOTER //\n// ./src/models/user.js","module.exports = require(\"bcrypt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bcrypt\"\n// module id = 15\n// module chunks = 0"],"sourceRoot":""}